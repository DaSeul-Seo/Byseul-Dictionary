## 정규화
|과목코드(PK)|과목명|학번(PK)|이름|연락처|
|---|---|---|---|---|
|C01|DB개론|2401|강감찬|010-1234-5678|
|C02|DB실무|2401|강감찬|010-1234-5678|
|A01|마이닝|2402|홍길동|010-6363-8282|
|B01|통계|2401|감강찬|010-1234-5678|
|C01|DB개론|2403|이춘향|010-9876-5432|

- 삭제 이상
    - 어떤 정보를 삭제하면서 원하지 않게 다른 정보도 삭제
    - 학번이 2402인 학생이 A01을 수강한 기록을 삭제할 때, 만일 A01을 수강하고 있는 다른 학생이 없을 경우 A01이라는 과목에 대한 정보가 다 날라감
- 삽입 이상
    - 관련 없는 다른 정보가 비어 있어 원하는 정보 입력 불가
    - 새로운 학생을 추가하고자 할때, 해당 테이블은 복합식별자를 가져 추가할 수 없음
        - (2404, 김유식, 0101-2226-4545) : 수강하는 과목에 대한 정보를 넣어야만 추가 가능
- 갱신 이상
    - 강감찬의 전화번호를 바꾸고 싶다면 3개의 정보가 바뀌어야 함
        - 테이블이 과목, 수강, 학생이 전부 통합되어 있기에 하나의 정보를 바꿀 때 여러 번의 업데이트가 일어나게 된다.
💡 뭉뚱그려저 있는 큰 테이블을 주제별로 독립된 테이블로 만들어 주어야 한다. => 정규화

### 정규화
- 최소한의 데이터 중복, 최대한의 데이터 유연성, 데이터 일관성을 위해 데이터를 분리하는 과정
- 데이터 중복을 제거하고 데이터 모델의 독립성을 확보
- 정규화를 통해 업무 상 변화가 생겨도 데이터 모델의 변경을 최소화할 수 있다.
- 논리 데이터 모델(개념, 물리 모델X) 상세화 과정의 대표적인 활동
- 목적
    - 데이터를 결정하는 결정자에 의해 함수적 종속을 가지고 있는 일반 속성을 의존자로 하여 입력/수정/삭제 이상을 제거하는 것

### ⭐ 정규화 종류 (정규화 절차)
- 정규형 (NF:Normal Form) : 정규화로 도출된 데이터 모델이 갖춰야 할 특성

1\) 제 1정규형 (1NF, 원자성, 완전함수종속성 제거)
- 모든 속성은 반드시 하나의 값을 가져야 한다.
- 중복 인스턴스 X

2\) 제 2정규형 (2NF, 부분함수종속성 제거)
- 엔터티의 일반속성은 주식별자 전체에 종속이어야 한다.

3\) 제 3정규형 (3NF, 이행함수종속성 제거)
- 엔터티의 일반속성 간에는 서로 종속적이지 않다.
- 이행종속성X : A → B, B → C의 관계가 제거된다는 것

💡 이전 단계의 정규형을 만족해야 그 다음 단계의 정규화를 진행할 수 있다.

### 함수적 종속성 (FD, Functional Dependency)
- 정규화는 함수적 종속성을 기반으로 수행된다.

#### EX
> - 학번, 혈액형 속성이 있다.
> - 수업을 듣는 학생들 중 A형을 가진 학생의 학번
> - 단 하나의 학번이 아닌 A형을 가진 학생들 전부의 학번이 나오게 된다.

- X값 하나에 대응하는 Y의 값이 하나만 존재해야만 함수라고 할 수 있다.
- 위의 예시는 함수라 얘기할 수 없다.

💡 혈액형은 학번을 함수적으로 결정하지 못한다. <br/>
💡 학번은 혈액형에 함수적으로 종속되지 않는다.

#### EX2
> - 2041이라는 학번을 가진 학생의 혈액형이 무엇인지 묻는다.
> - 결정되는 학생은 딱 한명이다.

💡 학번은 혈액형을 함수적으로 결정한다. <br/>
💡 혈액형은 학번에 함수적으로 종속된다.

#### 부분함수종속
- 하나의 PK가 혼자서 속성을 결정하는 것
    - 학번 하나로 학생명과 소속학과고드, 학과명이 결정됨

#### 이행함수종속
- 소속학과코드가 학과명을 결정함
    - 정규화를 통해 부분함수종속과 이행함수종속을 없애면, 식별자 전체에 의해 결정되는 것만 남게 된다.
    - 식별자가 아닌 속성(주식별자의 일부, 일반속성)이 결정자 역할을 하는 함수 종속을 제거하면 3정규형을 얻을 수 있다.

💡 정규화 : 자기애들끼리 독립해서 다른 테이블을 만들면 됨. 단, 결정자는 본 테이블에도 남아 있어야 한다.

### 정규화의 성능
- 데이터의 중복 감소 → 용량 최소화 → 성능향상
- 데이터가 관심사별로 묶임 → 성능향상
- 데이터 입력/수정/삭제 → 성능향상
- 조회(SELECT) 징의에서 JOIN이 많이 발생 → 성능 저하
    - 조건에 따라 성능 다름

4\) BCNF (3NF의 강화버전)
- 제 3규형을 만족하면서 모든 결정자가 후보 키 집합에 속해야 한다.
- 후보키 집합에 속하지 않은 컬럼이 결정자가 되어서는 안된다.

5\) 제 4정규형 (4NF)
- BCNF를 만족하며 다치 종속(Multivalued Dependency)이 없어야 한다.
- 다치 종속 조건
    - A → B일때, 하나의 A값에 여러 개의 B값이 존재
    - 최소 3개의 컬럼이 존재
    - R(A, B, C)가 있을 때, A와 B사이에 다치 종속성이 있으면 B와 C가 독립적이다.

|학생번호(PK)|과목명(PK)|취미|
|---|---|---|
|2401|DB개론|그림|
|2401|DB개론|게임|
|2401|DB실무|그림|
|2401|DB실무|게임|

- 이때 학생번호를 토대로 데이터 조회하면 중복이 발생한다.
- 과목, 취미는 서로 독립적인 관계이며, 둘 다 학생번호 컬럼에 다치 종속되어버려 중복이 발생
- 제 4차 정규화를 통해 분해

①
|학생번호(PK)|과목명(PK)|
|---|---|
|2401|DB개론|
|2401|DB실무|
|2402|마이닝|
|2402|DB실무|

②
|학생번호(PK)|취미|
|---|---|
|2401|그림|
|2401|게임|
|2402|축구|
|2402|게임|

6\) 제 5정규형 (5NF, 부분함수종속성 제거)
- Project Join Normal Form(PJNF)라고도 불린다.
- 4NF를 만족해야 하며, 조인 종속(Join Dependency)가 없어야 한다.
- 조인 연산을 했을 시, 손실이 없어야 한다.
- DB설계에서 매우 희귀하게 적용된다.
- 테이블 A를 B와 C로 분해했다고 다시 조인했을 때 그래도 A가 된다면, A는 조인 종속성이 있다고 한다.

### 반정규화 (범위 X)
#### 반정규화(=역정규화, Denomalization) != 비정규화
- DB의 성능 향상을 위해, 데이터 중복을 허용하고 조인을 줄이는 방법
- 시스템의 성능 향상, 개발 및 운영의 단순화를 위해 정규화 된 데이터 모델을 중복, 통합, 분리하는 모델링 기법
- 조회 속도를 향상시키거나, 데이터 모델의 유연성은 낮아진다.
- 입력/수정/삭제 성능이 저하된다는 것

#### 반정규화를 수행하는 경우
- 정규화를 통해 엔터티, 관계 수가 많아져 조회 Join으로 인한 성능 저하가 예상될 때
- 정규화에 충실해 종속성, 활용성을 향상되나 수행속도가 느려지는 경우
- 다량의 범위를 자주 처리해야하는 경우
- 특정 범위의 데이터만 자주 처리하는 경우
- 요약/집계 정보가 자주 요구되는 경우

💡 반정규화가 조회 성능 향상을 항상 보장하는 것은 아니다.

## 관계와 조인의 이해
### 관계
- 인스턴스의 연관성은 페어링
- 엔터티의 인스턴스 사이의 논리적인 연관성으로서 존재의 형태로서나 행위로서 서로에게 연관성이 부여된 상태
- 부모의 식별자를 자식의 식별자에 포함하면 식별관계
- 부모의 식별자를 자식의 일반속성으로 상속하면 비식별관계
- 관계를 맺는다 = 식별자를 상속시키고 해당 식별자를 매핑키로 활욯해 데이터를 결합하는 것

### 관계의 분류
- 존재 관계 : 엔터티가 다른 엔터티에 속함
    - ex) 사원 엔터티는 부소 엔터티에 속함
- 행위 관계 : '행위'를 통해서 발생
    - ex) 주문은 고객이 주문할 때 발생

### 조인 (JOIN)
- 식별자를 상속하고, 상속된 속성을 매핑키로 활용하여 데이터를 결합하는 것

### 관계형 데이터 모델
- 자기 자신끼리의 관계
- 하나의 엔터티 내에서 인스턴스끼리 계층 구조를 가지는 경우
- 셀프조인 : 계층 구조를 갖는 인스턴스끼리 연결하는 조인 (같은 테이블을 여러번 조인)

|직원ID(PK)|이름|상사ID|
|---|---|---|
|1|나사장|Null|
|2|김철수|1|
|3|이지현|1|
|4|황수지|2|
|5|박현석|3|

- 상사ID는 상사의 직원ID로 직원ID 컬럼과 관련이 있다.
- 어떤 직원의 상사의 이름을 알고 싶다면 셀프 조인해야 한다.

### 상호 배타적 관계 (Exclusive-OR 관계)
- 하나의 부모가 2개의 자식 엔터티를 가질 때, 행위 조건에 따라 두 자식 중 하나만 부모와 관계를 가질 수 있는 상황
- 두 자식 엔터티가 동시에 부모 엔터티와 연결될 수 없으며, 특정 조건에 의해 둘 중 하나만 선택적으로 관계를 유지한다.
    - eX) 주문 엔터티는 개인 또는 법인번호 둘 중 하나만 상속될 수 있음
    => 주문은 개인고객이거나 법인고객 둘 중 하나의 고객만이 가능함

## 모델이 표현하는 트랜잭션의 이해
### ⭐ 트랜잭션
- 업무 처리를 위한 논리적인 작업 단위
- 하나의 연속적인 업무 단위
- 트랜잭션에 의한 관계를 필수적인 관계 형태를 가진다.
- 하나의 트랜잭션에는 여러 SELECT, DELETE, UPDATE 등이 포함될 수 있다.
- 하나의 트랜잭션에 속한 동작들은 모두 성공하거나, 모두 취소(UNDO)되어야 한다. (원자성)
- 서로 독립적으로 업무가 발생해서는 안된다. 순차적으로 함께

### ⭐ 트랜잭션 특징
① 원자성 (Atomicity)
- 트랜잭션은 더 이상 분해가 불가능한 업무의 최소단위이므로, 전부 처리되거나 모두 처리되지 않아야 한다.

② 일관성 (Consistency)
- 일관된 상태의 DB에서 하나의 트랜잭션을 성공적으로 완료하고 나면 그 DB는 여전히 일관된 상태여야 한다.
- 트랜잭션 실행의 결과로 DB상태가 모순되지 않아야 한다.

③ 격리성 (Isolation)
- 실행 중인 트랜잭션의 중간 결과를 다른 트랜잭션이 접근할 수 없다.
- 수행 중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.

④ 영속성/지속성 (Durability)
- 트랜잭셩이 성공적으로 완료되었을 경우, 그 결과는 데이터베이스에 영속적으로 저장된다.
- 결과가 영구적으로 반영된다.
