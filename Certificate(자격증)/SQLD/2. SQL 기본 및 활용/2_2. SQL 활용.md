## ⭐ 서브쿼리
- 하나의 SQL문 안에 포함되어 있는 또 다른 SQL문

```SQL
SELECT p.id
      ,p.name
      ,p.price
      ,( SELECT a.name
         FROM artists a
         WHERE a.id = p.artist_id ) AS artist_name
FROM paintings p;
```

### 서브쿼리 사용 시 주의사항
- 괄호로 감싸서 사용
- 단일행 또는 복수행 비교 연산자와 함께 사용 가능
    - 단일행 비교 연산자는 서브쿼리의 결과가 반드시 1건 이하여야 하며, 복수행 비교 연산자는 서브쿼리의 결과 건수와 상관없음
- 서브쿼리엔 ORDER BY 사용 불가 **(ORDER BY 절에서 사용 가능)**
    - ORDER BY절은 SELECT절에서 오직 한 개만 올 수 있음
    - ORDER BY는 메인쿼리의 마지막 문장에 위치해야 함
    - 예외: TOP-N분석
- 서브쿼리는 쿼리 안에 포함된 또 다른 쿼리로, 메인쿼리를 보조하는 하위 쿼리
- 다양한 위치에서 사용될 수 있다.
    - SELECT절에서 특정 값을 계산하여 반환
    - FROM절에서 마치 테이블처럼 사용되어 서브쿼리의 결과를 임시 테이블로 취급
    - WHERE절에서 조건을 지정하는데 사용

### 서브쿼리가 위치할 수 있는 곳
- SELECT, FROM, WHERE, HAVING, ORDER BY 절 **[GROUP BY 불가]**
- 기타 DML: INSERT문의 VALUES절, UPDATE문의 SET절

### 동작 방식에 따른 서브쿼리 분류
- 연관 서브쿼리 (Correlated Subquery)
    - 서브쿼리가 메인쿼리의 컬럼을 가짐
- 비연과 서브쿼리(Un-Correlated Subquery)
    - 서브쿼리가 메인쿼리의 컬럼을 가지지 않음

#### ⭐ 목적
- 연관 서브쿼리
    - 일반적으로 메인쿼리가 먼저 수행되어 읽은 데이터를 서브쿼리에서 조건이 맞는지 확인할 때 사용
- 비연관 서브쿼리
    - 메인쿼리에 서브쿼리가 실행된 결과값을 제공하기 위한 목적으로 주로 사용
- 즉, 메인쿼리의 결과가 서브쿼리로 제공될 수 있고, 서브쿼리의 결과가 메인쿼리로 제공될 수 있음
    - 실행 순서는 상황에 따라 다르다는 것

### 반환되는 데이터 형태에 따른 서브쿼리 분류
- 단일행 서브쿼리
    - 서브쿼리의 실행 결과가 항상 1건 이하
    - 단일행 비교 연산자와 함께 사용 (=, <, <=, >, >=, <>)
    - 다중행 비교 연산자고 사용 가능
- 다중행 서브쿼리
    - 서브쿼리의 실행 결과가 여러 건인 서브쿼리
    - 다중행 비교 연산자와 함께 사용(IN, ALL, ANY, SOME, EXISTS)
    - 단일행 비교 연산자 사용 불가능
- 다중컬럼 서브쿼리
    - 서브쿼리의 실행 결과로 여러 컬럼 반환
    - 주로 메인쿼리의 조건과 비교하기 위해 사용
        - 비교하고자 하는 컬럼의 개수와 위치가 동일해야 함

<br />

📖 Reference
- [2024 개념정리](https://bruders.tistory.com/)
