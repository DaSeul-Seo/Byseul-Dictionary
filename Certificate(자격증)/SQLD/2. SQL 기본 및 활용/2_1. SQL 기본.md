## 관계형 데이터베이스 개요
### 데이터베이스
- 넓은 의미 : 일상적인 정보들을 모아놓은 것 자체
- 일반적인 의미 : 특정 기업이나 조직 또는 개인이 필요에 의해 데이터를 일정한 형태로 저장해 놓은 것

### DBMS (Database Management System)
- 데이터를 효율적으로 관리하기 위한 시스템
- 데이터의 손상을 피하며 필요한 데이터를 복구해주는 시스템
    - ex) MySQL, ORACLE

### 데이터베이스 발전
- 1960년대
    - Flowchart 중심의 개발 방법 사용
    - 파일 구조를 통해 데이터를 저장과 관리(파일시스템)
- 1970년대
    - DB관리 기법이 처음 출현(태동)
    - 계층형(Hierarchical), 망형(Network) 데이터베이스 제품 상용화
- 1980년대
    - 관계형(Relational) 데이터베이스 상요화
    - Oracle, Sybase, DB2 등의 제품 사용
- 1990년대
    - Oracle, Sybase, Informix, DB2, Teradate, SQL Server외 많은 제품 출현
    - 객체 관계형 데이터베이스로 발전

### 관계형 데이터베이스(Relational Database, RDB)
- 1970년 영국 수학자 E.F.Codd 박사 논문에서 처음 소개
- 기업의 핵심 데이터는 대부분 관계형 데이터베이스로 저장되어 있음
- 관계형 데이터베이스는 SQL 문장에 의해 관리됨

```sql
SELECT a.학번, a.학생이름, b.과목명
FROM 학생 a
INNER JOIN 수강 b
ON a.학번 = b.학번
```

### 관계형 데이터베이스의 구성요소
- 계정
    - 데이터의 접근 제한을 위해 업무별/시스템별로 존대
    - 모든 테이블이 모든 유저들에게 조회되게 할 수는 없으니까)
- 테이블
    - DBMS의 데이터베이스 안에 데이터가 저장되는 형식
- 스키마
    - 테이블이 어떠한 구성으로 이루어져 있는지
    - 테이블의 기본적인 구조 정의

### 테이블
- 테이블
    - 행과 열의 2차원 구조를 가진 데이터 저장 객체(Object)
    - 관계형 데이터베이스의 기본 단위
    - 릴레이션이 곧 테이블
- 컬럼/열 (Field)
    - 더 이상 나눌 수 없는 특성
- 로우/행
    - 레코드(Record)
    - 튜플(Tuple)

### ⭐ 테이블의 특징
- 하나의 테이블은 반드시 하나의 유저(계정)가 소유해야 한다.
- 테이블 간 관계 1:1, 1:N, N:N
- 테이블명은 중복될 수 없으나, 소유자가 다르면 같은 이름으로 생성 가능
    - 같은 계정으로 동일한 이름을 가진 객체 생성 불가능
- 테이블은 행 단위로 데이터가 입력, 삭제되며 수정은 값의 단위

### SQL (Structured Query Language)
- 관계형 데이터베이스에서 데이터 정의, 조작, 제어를 위해 사용하는 언어
- SQL문법은 대,소문자 구분하지 않음
- 종류 : 데이터 조작어(DML), 데이터 정의어(DDL), 데이터 제어어(DCL), 트랜잭션 제어어(TCL)

#### 💡 SQL 실행단계

1\) 파싱(Parsing)
- 문법 확인 및 구문 분석을 통해 올바른 SQL문인지 확인
- 파싱이 끝나면, 분서된 SQL이 라이브러리 캐시(Library Cache)에 저장
- Library Cache: 이전에 실행된 SQL문에 대한 정보를 저장하는 곳

2\) 실행(Execution)
- 옵티마이저(Optimizer)가 생성한 최적의 실행 계획에 따라 SQL문 실행

3\) 인출(Fetch)
- 실행 결과를 데이터베이스에서 사용자에게 전송하는 과정

### 관계형 데이터베이스 특징
- 데이터의 분류, 정렬, 탐색 속도가 빠르다.
- 신뢰성이 높고, 데이터의 무결성 보장한다.
- 기존의 작성된 스키마를 수정하기 어렵다.
- 데이터베이스의 부하를 분석하는 것이 어렵다.

### 데이터 무결성 (Integrity)
- 데이터의 정확성과 일관성을 유지하고, 데이터에 결손과 부정함이 없음을 보증하는 것
- 데이터베이스에 저장된 값과 그것이 표현하는 현실의 비즈니스 모델의 값이 일치하는 정확성을 의미
- 데이터 무결성을 유지하는 것이 DBMS에 중요한 기능
- **다양한 제약조건(기본키, 외래키, NOT NULL 제약, UNIQUE 제약 등)을 통해 데이터의 무결성이 유지됨**

### 데이터 무결정 종류
① 개체 무결성 : 테이블의 기본키를 구성하는 컬럼(속성)은 NULL 값X, 중복값X

② 참조 무결성 : 외래키

③ 도메인 무결성 : 주어진 속성 값이 정의된 도메인에 속한 값이어야 함

④ NULL 무결성 : 특정 속성에 대해 NULL을 허용하지 않음

⑤ 고유 무결성 : 특정 속성에 대해 값이 중복되지 않음

⑥ 키 무결성 : 하나의 관계에는 적어도 하나의 키가 존재해야 함 (테이블이 서로 관계를 가진다면, 반드시 하나 이상의 조인키를 가짐)

### ⭐ Relational Model Constraints (제약조건)
<4대 제약 조건> <br/>
💡 3대는 키와 개체 무결성 제약을 합침

① 도메인 제약 (Domain Constraints)
- 속성(Attribute)에 대한 제약 

② 키 제약 (Key Constraints)
- 릴레이션(Relation)에 대한 제약(테이블)
- 테이블은 키(PK)를 가져야 한다.

③ 개체 무결성 제약 (Entity Integrity Constraints)
- 기본키(Primary Key)에 대한 제약
- 테이블이 가진 키는 자고로 이래야 한다는 제약
- PK는 UNIQUE하면서 NOT NULL이어야 한다.

④ 참조 무결성 제약 (Referential Integrity Constraints)
- 외래키(Foreign Key)에 대한 제약

### 도메인 제약
- 속성 값은 원자성(Atomicity)을 가지며 도메인에서 정의된 값이어야 함
- Composite Attribute와 Multivalued Attribute는 허용 X
    - 주소 = 시군구 + 상세주소
- NULL값은 허용됨 (NOT NULL이 아닌 속성이라면)

|학번|이름|나이|차량번호|취미|
|---|---|---|---|---|
|1234|홍길동|21|01가1234|체조|
|5678|강감찬|①고려|②|③축구,농구,배구|

① 도메인에서 정의된 값 위배<br/>
② NULL값 허용이라 괜찮음<br/>
③ Multivalued Attribute, 원자성 위배

### 키 제약
- 릴레이션의 모든 튜플은 서로 식별 가능해야 함

①
|이름|나이|혈액형|전공|
|---|---|---|---|
|홍길동|21|A|경영정보|
|강감찬|22|O|정보시스템|

- 잘목된 테이블
- 각 속성으로도 튜플 식별불가
- 4개의 속성을 복합식별자로 두어도 식별 불가
- PK가 없는 테이블 => 인조식별자 만들면 됨

②
|이름|나이|학번|주민번호|
|---|---|---|---|
|홍길동|21|1234|111-2222|
|강감찬|22|5678|333-4444|

- 문제 없는 릴레이션
- 후보키: 학번, 주민번호

### 개체 무결성 제약
- 기본키(PK)는 NOT NULL & UNIQUE

### 참조 무결성 제약
- 외래키(FK)
    - 릴레이션 R1이 릴레이션 R2를 참조하는 경우, R2의 기본키는 R1에서 외래키로 사용됨
    - 가져온 키의 필드명은 바꿀 수 있음
    - FK는 자기 자신이 속한 릴레이션을 참고할 수 있다.

[학생 R1]
|학번|이름|나이|소속|멘토|
|---|---|---|---|---|
|1234|홍길동|21|MIS||
|2345|강감찬|22|MIS|1234|
|3456|김유신|23|경영||
|4567|유관순|22|컴공|2345|

[학과 R2]
|학과|정원|위치|
|---|---|---|
|MIS|100|경상관|
|경영|200|경상관|
|컴공|100|공학관|
|수학|50|자연관|

💡 소속은 학과명을 참고, 멘토는 학번을 참고하고 있음

### ERD (Entity Relationship Diagram)
- 테이블 간 서로의 상관관계를 그림으로 도식화(표현)한 것
- 관계의 의미를 직관적으로 표현할 수 있는 수단
- 구성요소: 엔터티(Entity), 관계(Relationship), 속성(Attribute)
- 현실 세계의 데이터는 구성요소 3가지로 모두 표현이 가능

## SELECT문
### SQL 문장들의 종류
<table>
    <thead>
        <tr style="text-align: center;">
            <td>명령어 종류</td>
            <td>명령어</td>
            <td>설명</td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td rowspan="2" style="text-align: center;">데이터 조작어<br/>(DML; Data Manipulation Language)</td>
            <td style="text-align: center;">SELECT</td>
            <td>
                - 데이터를 조회, 검색하기 위한 명령어 <br/>
                - RETRIEVE 라고도 함
            </td>
        </tr>
        <tr>
            <td style="text-align: center;">INSERT<br/>UPDATE<br/>DELETE<br/>MERGE</td>
            <td>
                - 데이터에 변형을 가하는 명령어<br/>
                - ex) 데이터를 테이블의 새로운 행에 집어넣기<br/>
                - ex) 원하지 않는 데이터 삭제<br/>
                - ex) 데이터 수정
            </td>
        </tr>
        <tr>
            <td style="text-align: center;">데이터 정의어<br/>(DDL; Data Definition Language)</td>
            <td style="text-align: center;">CREATE<br/>ALTER<br/>DROP<br/>RENAME<br/>TRUNCATE</td>
            <td>
                - 테이블과 같은 데이터 구조를 정의하는 데 사용되는 명령어<br/>
                - 테이블의 구조를 생성, 변경, 삭제<br/>
                - 이름 바꾸기 등 데이터 구조와 관련된 명령어
            </td>
        </tr>
        <tr>
            <td style="text-align: center;">데이터 제어어<br/>(DCL; Data Control Language)</td>
            <td style="text-align: center;">GRANT<br/>REVOKE</td>
            <td>
                - 데이터베이스에 접근하고 객체들을 사용하도록 권한을 주고 회수하는 명령어
            </td>
        </tr>
        <tr>
            <td style="text-align: center;">트랜잭션 제어어<br/>(TCL; Transaction Control Language)</td>
            <td style="text-align: center;">COMMIT<br/>ROLLBACK<br/>SAVEPOINT</td>
            <td>
                - 논리적인 작업의 단위를 묶어서 DML에 의해 조작된 결과를 작업단위(트랜잭션) 별로 제어하는 명령어
            </td>
        </tr>
    </tbody>
</table>

⭐ DML : 사용자가 COMMIT 해야함 → ROLLBACK 가능<br/>
⭐ DDL : AUTO COMMIT → ROLLBACK 불가능

### SELECT 문의 구조
```SQL
SELECT * | 컬럼명 | 표현식
FROM 테이블명/뷰명
WHERE 조회조건
GROUP BY 그룹화 기준 컬럼명
HAVING 그룹핑 필터링 조건
ORDER BY 정렬 기준 컬럼명
```

> 💡 MySQL 쿼리 작성 순서<br/>
> SELECT → FROM → WHERE → GROUP BY → HAVING → ORDER BY<br/>
> 💡 MySQL 쿼리 처리 순서 / 논리적 실행 순서<br/>
> FROM → WHERE → GROUP BY → HAVING → SELECT → ORDER BY

### SELECT 절
- SELECT 문장을 사용해 불러올 컬럼명, 연산 결과를 작성하는 절
- \* : 테이블 내 모든 컬럼 조회
- 표현식 : 기존 컬럼명을 그래도 적는 것이 아닌 연삭식, 기존 컬럼의 함수 변형식

### AS
- SQL에서 별칭(Alias)을 만들 때 사용하는 키워드 (생략 가능)
- 별칭을 통해 출력할 컬럼이나 테이블에 임시로 이름을 부여할 수 있다.
- 별칭은 결과에만 적용되며, 실제 데이터베이스 테이블에는 영향X

### AS의 특징 / 주요사항
- **SELECT문보다 늦게 사용되는 ORDER BY정에서만 컬럼 별칭 사용 가능**
    - HAVING이나 WHERE절에서 사용 시 에러 발생
- ⭐ 오라클에서 테이블 별칭을 명시할 때 AS를 사용할 수 없다.
- 이미 존재하는 예약어로는 당연히 사용 불가
    - ex) SELECT, AVG 등
- 경우에 따라 큰따옴표("")를 사용 (역따옴표도 가능)
    - 공백포함
    - 특부문자 포함(_, $, #는 제외)
    - 별칭 그대로 전달하고자 할 때

### SELECT [ALL/DISTINCT]
- ALL
    - 디폴트 옵션 → 별도 포시하지 않아도 됨
    - 중복된 데이터가 있어도 모두 출력
- ⭐DISTINCT
    - 중복된 데이터의 경우, 1건으로 처리해서 출력

### FROM절
- 데이터를 불러올 테이블명이나 뷰명 전달
- 여러 테이블 전달 가능(컴마로 구분)
- 여러 테이블 사이에 JOIN 조건이 존재하지 않다면, SQL은 두 테이블의 모든 가능한 조합을 생성(Cartesian Product)
- 테이블도 별칭 선언 가능
    - ORACLE은 AS 사용 불가
    - SQL Server는 사용/생략 가능
- **테이블에 별칭 사용시, 해당 테이블을 참조할 때 반드시 별칭을 사용해야 한다.**
- **ORACLE에서는 FROM절 생략 불가** (Oracle 23c 부터는 가능)
    - 의미상 테이블이 필요 없다면 DUAL 테이블 선언
- SQL Server에서는 FROM 정리 필요 없다면 생략 가능

### SQL문 작성 시 주의사항
- 문자 상수나 날짜 상수 표현 시 홀따옴표 사용
- ORACLE은 문자 상수의 경우 대소문자를 구분
- MSSQL은 기본적으로 문자 상수의 대소문자를 구분X
- MySQL은 비교나 검색을 수행할 때 기본적으로 대소분자 구분없이 비교 및 검색이 가능

## 함수
### 함수
- 입력값을 받아 처리하고 결과(출력값)를 반환

① 단일행 함수 (Single-Row Functions)
- 하나의 입력 값에 대해 하나의 결과를 반환하는 함수 (1:1관계)
    - **각 행들에 대해 개별적으로 작용하여 데이터 값들을 조작하고, 각 행에 대한 조작 결과를 반환한다**는 뜻
- 주로 데이터 변환이나 조작에 사용
- 보통 SELECT, WHERE, ORDER BY절에서 사용
- 함수 중첩 가능
    - ex) UPPER(CONCAT(first_name, '', last_name))

```SQL
SELECT UPPER(name), SUBSTRING(name, 1, 3)
FROM EMPLOYEE
WHERE LENGTH(name) > 5
ORDER BY LOWER(name);
```

② 복수행 (다중행) 함수 (Multi-Row Functions)
- **여러 행의 데이터를 하나의 결과값으로 반환**하는 함수
- 주로 합계, 평균, 개수, 최대/최소 값 등을 계산하는 데 사용
- 이런 집계를 목적으로 하는 함수들이 GROUP BY와 잘 어울려져 사용됨
- 보통 SELECT, HAVING 정에서 사용 (ORDER BY 절에서도 사용 가능)

```SQL
SELECT department, AVG(salary) AS average_salary
FROM EMPLOYEE
GROUP BY department
HAVING AVG(salary) > 3000
ORDER BY average_salart DESC;
```

💡 합성 연산
```SQL
-- (1) || (Oracle)
SELECT FIRST_NAME || ' ' || LAST_NAME AS FULL_NAME
FROM EMPLOYEES;
-- (2) + (SQL Server)
SELECT FIRST_NAME + ' ' + LAST_NAME AS FULL_NAME
FROM EMPLOYEES;
-- (3) CONCAT
SELECT CONCAT('Hello, ', 'World!') AS greeting;
```

💡 숫자형 함수 모음: 단일행 함수
[그림]

💡 문자열 함수 모음 (ORACLE): 문자열 결합, 추출, 삭제, 단일행 함수
[그림]

- SQL SERVER
    - SUBSTR → SUBSTRING
    - LENGTH → LEN
    - INSTR → CHARINDEX

💡 날짜형 함수 모음 (ORACLE): 단일행 함수
[그림]

- DBMS마다 날짜 출력 형식은 다르다.
- SQL SERVER
    - SYSDATE → GETDATE()
    - EXTRACT(year|month|day from d) → DATEPART(year|month|day, d)
    - ADD_MONTHS(d, n) → DATEADD(year|month|dat, d, n)월 뿐만이 아니라 모든 날짜 단위 연산이 가능하다.
    - TO_NUMBER(TO_CHAR(d, 'YYYY' | 'MM' | 'DD')) → YEAR(d), MONTH(d), DAY(d)
    - MONTHS_BETWEEN(d1, d2) → DATEDIFF(year|month|day, d1, d2)

💡 변환 함수 모음: 단일행 함수
[그림]

- 일반적인 데이터 형식 변환에는 CAST를 사용할 수 있지만, 날짜 및 시간 변환 시 특정 형식을 요구하는 경우에는 CONVERT를 사용하는 것이 좋다.

💡 집계 함수 모음: 복수행(다중행) 함수, NULL값은 으로 계산되는 것이 아니라 무시
[그림]

- MAX(), MIN()은 날짜형 데이터에도 사용이 가능
    - ex) MAX(ORDER_DATE) : 가장 최근 주문 날짜 반환
- SQL SERVER
    - STDDEV → STDEV
    - VERIANCE() → VAR()

💡⭐ NULL 관련 함수 및 기타 함수 모음 (ORACLE)
[그림]

<br/>

📖 Reference
- [2024 개념정리](https://bruders.tistory.com/)

